\documentclass[12pt,openany,titlepage]{book}

\usepackage[T1]{fontenc}
\usepackage[fleqn]{amsmath}
\usepackage{amsthm}
\usepackage{tocloft}
\usepackage{titlesec}
\usepackage{fancyhdr}
\usepackage[shortlabels]{enumitem}
\usepackage{lipsum}

\IfFileExists{mtpro2.sty}{
    % Enable Times Roman font for the main text to make it consistent with the textbook:
    \usepackage{newtxtext,newtxmath}
    % Use mtpro2 math font set.
    % To make math fonts even more consistent with the textbook, acquire the mtpro2 complete version, and change below options:
    % - remove lite
    % - change eucal to mtpcal
    % - change amsbb to mtphrb
    \usepackage[lite,eucal,amsbb,subscriptcorrection,zswash]{mtpro2}
}{
    % Alternatively, in case mtpro2 isn't available, use Palatino and AMS Euler fonts:
    \usepackage{amssymb}
    \usepackage{newpxtext}
    \usepackage[euler-digits,euler-hat-accent]{eulervm}
}

\usepackage[screen]{clrscode4e}

\usepackage[
    pdfborder={0 0 0},
    pdftex,
    pdfauthor={Krzysztof Wojtas},
    pdftitle={clrs4e-solutions},
    pdfsubject={Introduction to Algorithms, 4th ed. -- solutions to exercises and problems},
    bookmarks=true,
    hypertexnames=false,
    unicode=true]{hyperref}

\usepackage{tikz}
\usepackage[font=small,labelfont=bf,labelsep=quad]{caption}

\definecolor{accentcolor}{cmyk}{0.71, 0.2, 0, 0.29}

\setlength{\textheight}{.75\paperheight}
\setlength{\leftmargin}{.2\paperwidth}
\setlength{\rightmargin}{.1\paperwidth}
\setcounter{tocdepth}{1}
\setcounter{secnumdepth}{3}

\renewcommand{\thechapter}{\arabic{chapter}}
\renewcommand{\thesection}{\thechapter.\arabic{section}}
\renewcommand{\thesubsection}{\thesection-\arabic{subsection}}
\renewcommand{\thesubsubsection}{\alph{subsubsection}.}

\pagestyle{fancy}
%\fancyheadoffset[LE]{\marginparwidth}
\renewcommand{\chaptermark}[1]{\markboth{\chaptertitlename\ \thechapter\quad#1}{}}
\renewcommand{\sectionmark}[1]{\markright{\thesection\quad#1}}
\fancyhead[LO]{\nouppercase{\small\textit{\rightmark}}}
\fancyhead[RE]{\nouppercase{\small\textit{\leftmark}}}
\fancyhead[LE,RO]{\small\textit{\thepage}}
\fancyfoot{}
\renewcommand{\headrulewidth}{0pt}

\fancypagestyle{plain}{\fancyhf{}}

\titleformat{\chapter}[display]
{\normalfont\color{accentcolor}\Large\filright\bfseries}
{}
{0pt}
{\titlerule[5pt]\vspace{8pt}\thechapter\quad}

\titleformat{\section}[hang]{\large\bfseries\filright}{\thesection}{1em}{}
\titlespacing*{\section}{0pt}{2em}{0.4em}
\titleformat{\subsection}[hang]{\bfseries\itshape\filright}{\thesubsection}{1em}{}
\titlespacing*{\subsection}{0pt}{1em}{0pt}
\titleformat{\subsubsection}[runin]{\bfseries\itshape}{\thesubsubsection}{1em}{}
\titlespacing*{\subsubsection}{0pt}{*1.5}{1ex}

\newcommand{\exercise}{\subsection{}\label{sol:\thesubsection}}
\newcommand{\subexercise}{\subsubsection{}}
\newcommand{\problems}{%
    \section*{Problems}
    \phantomsection\addcontentsline{toc}{section}{Problems}
    \setcounter{subsection}{0}
    \renewcommand{\thesection}{\thechapter}
    \fancyhead[LO]{\small\textit{Problems for \chaptername\ \thechapter}}
}
\newcommand{\problem}[1]{\subsection{#1}\label{sol:\thesubsection}}
\newcommand{\subproblem}{\subsubsection{}\label{sub:\thesubsection\thesubsubsection}}

\let\originalchapter=\chapter
\renewcommand{\chapter}[1]{%
    \originalchapter{#1}
    \setcounter{section}{0}
    \renewcommand{\thesection}{\thechapter.\arabic{section}}
    \fancyhead[LO]{\nouppercase{\small\textit{\rightmark}}}
}

\begin{document}

    \frontmatter

    \include{title}

    \ifpdf
    \addtocontents{toc}{\protect\pdfbookmark{Contents}{toc}}
    \fi

    \tableofcontents

    \mainmatter

    Hello, World!

    \backmatter

    \let\chapter=\originalchapter
    \bibliographystyle{plain}
    \bibliography{clrs4e-solutions}
    \nocite{*}

\end{document}
