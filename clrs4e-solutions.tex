\documentclass[oneside,11pt,openany,titlepage]{book}

% project-wide constants
\newlength{\lmarginparwidth}
\setlength{\lmarginparwidth}{1in}
\newlength{\thinrulethickness}
\setlength{\thinrulethickness}{.5pt}
\newlength{\thickrulethickness}
\setlength{\thickrulethickness}{5pt}

\usepackage[T1]{fontenc}
\usepackage[fleqn]{amsmath}
\usepackage{amsthm}
\usepackage{calc}
\usepackage[
    lines=40,
    reversemp,
    lmargin=1in+\lmarginparwidth,
    includehead]{geometry}
\usepackage{tocloft}
\usepackage{titlesec}
\usepackage[twoside]{fancyhdr}
\usepackage[
    font=footnotesize,
    labelfont=bf,
    labelsep=quad,
    singlelinecheck=false]{caption}
\usepackage[
    font=footnotesize,
    labelfont=rm,
    singlelinecheck=true,
    labelformat=simple]{subcaption}
\usepackage[shortlabels]{enumitem}
\usepackage[screen]{clrscode4e}
\usepackage{tikz}
\usepackage{latexcolors}
\usepackage{import}

% TODO: Remove when #1566 is fixed
\usepackage{environ}

\IfFileExists{mtpro2.sty}{% Enable Times Roman font for the main text to make it consistent with the textbook:
    \usepackage{txfonts}
    % Use mtpro2 math font set.
    % TODO: To make math fonts even more consistent with the textbook, acquire the mtpro2 complete version,
    %   and change below options:
    %   - remove lite
    %   - change eucal to mtpcal
    %   - change amsbb to mtphrb
    \usepackage[lite,eucal,amsbb,subscriptcorrection,zswash]{mtpro2}
    % TODO: Remove when #1566 is fixed
    \NewEnviron{Cases}{\ccases{\BODY}}
}{% Alternatively, in case mtpro2 isn't available, use Palatino and AMS Euler fonts:
    \usepackage{amssymb}
    \usepackage{newpxtext}
    \usepackage[euler-digits,euler-hat-accent]{eulervm}
    % TODO: Remove when #1566 is fixed
    \NewEnviron{Cases}{\begin{cases}\BODY\end{cases}}
}

\usepackage[
    pdfborder={0 0 0},
    pdftex,
    pdfauthor={Krzysztof Wojtas},
    pdftitle={clrs4e-solutions},
    pdfsubject={Introduction to Algorithms, 4th ed. -- solutions to exercises and problems},
    bookmarks=true,
    hypertexnames=false,
    unicode=true]{hyperref}


\colorlet{accentcolor}{blue(ncs)}
\definecolor{orange}{cmyk}{0,0.47,0.87,0.04}
\definecolor{tan}{cmyk}{0,0.1,0.3,0}

\renewcommand{\thechapter}{\arabic{chapter}}
\renewcommand{\thesection}{\thechapter.\arabic{section}}
\renewcommand{\thesubsection}{\thesection-\arabic{subsection}}
\renewcommand{\thesubsubsection}{\alph{subsubsection}.}

\renewcommand{\thefigure}{\thesubsection}
\renewcommand{\thesubfigure}{(\alph{subfigure})}

\pagestyle{fancy}
\renewcommand{\chaptermark}[1]{\markboth{\chaptertitlename~\thechapter\quad#1}{}}
\renewcommand{\sectionmark}[1]{\markright{\thesection\quad#1}}
\fancyhead[LO]{\nouppercase{\footnotesize\textit{\rightmark}}}
\fancyhead[RE]{\nouppercase{\footnotesize\textit{\leftmark}}}
\fancyhead[LE,RO]{\footnotesize\textit{\thepage}}
\fancyheadoffset[LE]{\lmarginparwidth}
\fancyfoot{}
\renewcommand{\headrulewidth}{0pt}

\fancypagestyle{plain}{\fancyhf{}}

\titleformat{\part}[display]
  {\normalfont\color{accentcolor}\Large\bfseries\itshape}
  {}
  {0pt}
  {\titlerule[\thickrulethickness]\vspace{2in}\titlerule[\thinrulethickness]\vspace{1pt}%
    \partname~\thepart\hspace{\lmarginparwidth-\widthof{\partname~\thepart}}\vspace{-\baselineskip}}
\titlespacing*{\part}{-\lmarginparwidth}{-\baselineskip-\topskip}{0pt}

\titleformat{\chapter}[display]
  {\normalfont\color{accentcolor}\Large\bfseries}
  {}
  {0pt}
  {\titlerule[\thickrulethickness]\vspace{8pt}%
    \thechapter\hspace{\lmarginparwidth-\widthof{\thechapter}}}
\titlespacing*{\chapter}{-\lmarginparwidth}{-\baselineskip-\topskip}{1.5in}

\let\originalchapter=\chapter
\renewcommand{\chapter}[1]{%
    \originalchapter{#1}
    \titleformat{\section}[display]{\large\bfseries}{}{0pt}{\titlerule[\thinrulethickness]\vspace{3pt}\thesection\quad}
    \titleformat{\subsection}[runin]{\bfseries\itshape}{\makebox[\lmarginparwidth][l]{\thesubsection}}{0pt}{}
    \titlespacing*{\subsection}{-\lmarginparwidth}{*3}{0pt}
    \renewcommand{\thesection}{\thechapter.\arabic{section}}
    \fancyhead[LO]{\nouppercase{\footnotesize\textit{\rightmark}}}
}

\newcommand{\problems}{%
    \titleformat{\section}[display]{\large\bfseries}{}{0pt}{\titlerule[\thinrulethickness]\vspace{3pt}}
    \titleformat{\subsection}[hang]{\bfseries\itshape}{\makebox[\lmarginparwidth][l]{\thesubsection}}{0pt}{}
    \titlespacing*{\subsection}{-\lmarginparwidth}{*3}{*2}
    \section*{Problems}
    \phantomsection\addcontentsline{toc}{section}{Problems}
    \setcounter{subsection}{0}
    \renewcommand{\thesection}{\thechapter}
    \fancyhead[LO]{\footnotesize\textit{Problems for \chaptertitlename~\thechapter}}
}

\titlespacing*{\section}{-\lmarginparwidth}{*5}{*2}
\titleformat{\subsubsection}[runin]{\bfseries\itshape}{\thesubsubsection}{1em}{}
\titlespacing*{\subsubsection}{0pt}{*3}{*2}

\newcommand{\exercise}{\subsection{}\label{sol:\thesubsection}}
\newcommand{\subexercise}{\subsubsection{}\label{sol:\thesubsection\thesubsubsection}}
\newcommand{\problem}[1]{\subsection{#1}\label{sol:\thesubsection}}
\newcommand{\subproblem}{\subsubsection{}\label{sol:\thesubsection\thesubsubsection}}

\renewcommand{\cfttoctitlefont}{\normalfont\color{accentcolor}\Large}
\renewcommand{\cftbeforetoctitleskip}{0pt}
\renewcommand{\cftaftertoctitleskip}{1.5in}
\renewcommand{\cftdotsep}{\cftnodots}
\setcounter{tocdepth}{1}
\setcounter{secnumdepth}{3}

\setlist[itemize]{left=0pt}
\setlist[enumerate]{left=0pt}

\renewcommand{\footnoterule}{%
  \kern -3pt
  \hrule width \textwidth
  \kern 2pt
}

\newtheoremstyle{clrs}{}{}{}{}{\bfseries\itshape}{}{\newline}{}
\theoremstyle{clrs}
\newtheorem*{theorem}{Theorem}
\newtheorem*{lemma}{Lemma}
\renewcommand{\qedsymbol}{\hfill\ensuremath{\blacksquare}{\parfillskip=0pt\par}}
\renewenvironment{proof}{{\noindent\bfseries\itshape Proof\quad}}{\hfill\qedsymbol}

\newcommand{\dash}{\,---\,}
\newcommand{\concept}[1]{\textcolor{accentcolor}{\textbf{\itshape{#1}}}}
\newcommand{\refExercise}[1]{Exercise~\mbox{\ref{sol:#1}}}
\newcommand{\refProblem}[1]{Problem~\mbox{\ref{sol:#1}}}
\newcommand{\refFigure}[1]{Figure~\mbox{\ref{fig:#1}}}

\DeclareMathOperator{\degree}{degree}

\usetikzlibrary{
    arrows.meta,
    bending,
    positioning}

\tikzset{
    every node/.style = {font=\footnotesize},
	light blue/.style = {fill=cyan!25},
    arrow/.style = {->, >={Stealth[bend]}, draw},
    level/.style = {level distance=10mm, sibling distance=60mm/2^#1},
    tree node/.style = {align=center, inner sep=-1pt, minimum size=5mm, text height=1.5ex, text depth=.1ex, circle, draw=orange, fill=tan},
}


\begin{document}

    \setlength{\mathindent}{0pt}
    \setlength{\abovedisplayskip}{1ex}

    \frontmatter

    \import{./}{title}

    \ifpdf
        \addtocontents{toc}{\protect\pdfbookmark{Contents}{toc}}
    \fi

    \tableofcontents

    \mainmatter

    \setcounter{part}{7}
    \part{Appendix: Mathematical Background}

    \appendix
    \import{appendixa/}{main}
    \import{appendixb/}{main}

    \backmatter

    \let\chapter=\originalchapter
    \titleformat{\chapter}{\normalfont\color{accentcolor}\Large}{}{0pt}{}
    \titlespacing*{\chapter}{0pt}{0pt}{1.5in}
    \bibliographystyle{plain}
    {\footnotesize\bibliography{clrs4e-solutions}}
    \nocite{*}

\end{document}
